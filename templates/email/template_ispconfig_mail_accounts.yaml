zabbix_export:
  version: '7.2'
  template_groups:
    - uuid: 7df96b18-f235-90f9-9181-2c9f04857890
      name: 'ISPConfig'
  templates:
    - uuid: c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0
      template: 'ISPConfig Email Accounts'
      name: 'ISPConfig Email Accounts Monitoring'
      description: |
        Template for monitoring ISPConfig email accounts
        
        This template discovers email accounts from ISPConfig and monitors:
        - Email account status (active/inactive)
        - Email address and domain
        - Mailbox quota and usage
        - Usage percentage
        - Spamfilter and antivirus status
        
        Requirements:
        - ISPConfig 3.2+ with SOAP API enabled
        - Zabbix Agent with UserParameter configured
        - PHP 7.4+ with SOAP extension
        - Email module enabled in configuration
        
        Author: ISPConfig Zabbix Monitoring Project
        Version: 1.0.0
      groups:
        - name: 'ISPConfig'
      discovery_rules:
        - uuid: d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2
          name: 'ISPConfig Email Accounts Discovery'
          type: ZABBIX_ACTIVE
          key: 'ispconfig.emails.discovery'
          delay: 1h
          lifetime: 7d
          description: 'Discovers all email accounts configured in ISPConfig'
          item_prototypes:
            - uuid: e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3
              name: 'Email {#EMAIL}: Active Status'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.email.active[{#MAIL_USER_ID}]'
              delay: 5m
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              description: 'Active status of email {#EMAIL}'
              tags:
                - tag: Application
                  value: 'ISPConfig Email'
                - tag: Email
                  value: '{#EMAIL}'
              
            - uuid: f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4
              name: 'Email {#EMAIL}: Email Address'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.email.email[{#MAIL_USER_ID}]'
              delay: 1h
              history: 7d
              trends: '0'
              value_type: CHAR
              description: 'Full email address'
              tags:
                - tag: Application
                  value: 'ISPConfig Email'
                - tag: Email
                  value: '{#EMAIL}'
              
            - uuid: a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5
              name: 'Email {#EMAIL}: Domain'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.email.domain[{#MAIL_USER_ID}]'
              delay: 1h
              history: 7d
              trends: '0'
              value_type: CHAR
              description: 'Domain name of email'
              tags:
                - tag: Application
                  value: 'ISPConfig Email'
              
            - uuid: b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6
              name: 'Email {#EMAIL}: Mailbox Usage'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.email.used[{#MAIL_USER_ID}]'
              delay: 10m
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              units: B
              description: 'Current mailbox usage for email {#EMAIL}'
              tags:
                - tag: Application
                  value: 'ISPConfig Email'
              
            - uuid: c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7
              name: 'Email {#EMAIL}: Mailbox Quota'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.email.quota[{#MAIL_USER_ID}]'
              delay: 1h
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              units: B
              description: 'Mailbox quota for email {#EMAIL}'
              tags:
                - tag: Application
                  value: 'ISPConfig Email'
              
            - uuid: d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8
              name: 'Email {#EMAIL}: Usage Percentage'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.email.usage_percent[{#MAIL_USER_ID}]'
              delay: 10m
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              units: '%'
              description: 'Mailbox usage percentage for email {#EMAIL}'
              tags:
                - tag: Application
                  value: 'ISPConfig Email'
              
            - uuid: e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9
              name: 'Email {#EMAIL}: Spamfilter Enabled'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.email.spamfilter_enabled[{#MAIL_USER_ID}]'
              delay: 1h
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              description: 'Spamfilter status for email {#EMAIL}'
              tags:
                - tag: Application
                  value: 'ISPConfig Email'
              
            - uuid: f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0
              name: 'Email {#EMAIL}: Antivirus Enabled'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.email.antivirus_enabled[{#MAIL_USER_ID}]'
              delay: 1h
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              description: 'Antivirus status for email {#EMAIL}'
              tags:
                - tag: Application
                  value: 'ISPConfig Email'
          
          trigger_prototypes:
            - uuid: a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1
              expression: 'last(/ISPConfig Email Accounts/ispconfig.email.active[{#MAIL_USER_ID}])=0'
              name: 'Email {#EMAIL} is inactive'
              priority: WARNING
              description: 'Email {#EMAIL} has been marked as inactive in ISPConfig'
              tags:
                - tag: Email
                  value: '{#EMAIL}'
              
            - uuid: b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2
              expression: 'last(/ISPConfig Email Accounts/ispconfig.email.usage_percent[{#MAIL_USER_ID}])>90'
              name: 'Email {#EMAIL} mailbox usage high (>90%)'
              priority: WARNING
              description: 'Email {#EMAIL} is using more than 90% of its mailbox quota'
              manual_close: 'YES'
              tags:
                - tag: Email
                  value: '{#EMAIL}'
              
            - uuid: c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3
              expression: 'last(/ISPConfig Email Accounts/ispconfig.email.usage_percent[{#MAIL_USER_ID}])>=100'
              name: 'Email {#EMAIL} mailbox quota exceeded'
              priority: HIGH
              description: 'Email {#EMAIL} has exceeded its mailbox quota'
              manual_close: 'YES'
              dependencies:
                - name: 'Email {#EMAIL} mailbox usage high (>90%)'
              tags:
                - tag: Email
                  value: '{#EMAIL}'
          
          graph_prototypes:
            - uuid: d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4
              name: 'Email {#EMAIL}: Mailbox Usage'
              width: '900'
              height: '200'
              show_work_period: 'NO'
              show_triggers: 'YES'
              type: STACKED
              graph_items:
                - color: 1A7C11
      
      macros:
        - macro: '{$ISPCONFIG.EMAIL.WARN}'
          value: '90'
          description: 'Mailbox usage warning threshold (percentage)'
        
        - macro: '{$ISPCONFIG.EMAIL.CRIT}'
          value: '100'
          description: 'Mailbox usage critical threshold (percentage)'
