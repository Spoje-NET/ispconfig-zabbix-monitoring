zabbix_export:
  version: '7.2'
  template_groups:
    - uuid: fd6ec9b2-4bda-4d65-9d8b-6c454aa5d010
      name: 'ISPConfig'
  templates:
    - uuid: d60ae4ed-5869-404c-9c44-531a44d2ded6
      template: 'ISPConfig Websites'
      name: 'ISPConfig Websites Monitoring'
      description: |
        Template for monitoring ISPConfig websites
        
        This template discovers websites from ISPConfig and monitors:
        - Website status (active/inactive)
        - Domain information
        - PHP version
        - SSL configuration
        - Disk usage and quotas
        - Traffic statistics
        
        Requirements:
        - ISPConfig 3.2+ with SOAP API enabled
        - Zabbix Agent with UserParameter configured
        - PHP 7.4+ with SOAP extension
        
        Author: ISPConfig Zabbix Monitoring Project
        Version: 1.0.0
      groups:
        - name: 'ISPConfig'
      discovery_rules:
        - uuid: cd0fbd6a-8d63-4336-ad63-65868140ab3a
          name: 'ISPConfig Websites Discovery'
          type: ZABBIX_ACTIVE
          key: 'ispconfig.websites.discovery'
          delay: 1h
          lifetime: 7d
          description: 'Discovers all websites configured in ISPConfig'
          item_prototypes:
            - uuid: 2b8b384a-0c0f-4258-a296-62ff360c4637
              name: 'Website {#DOMAIN}: Active Status'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.website.active[{#WEBSITE_ID}]'
              delay: 5m
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              description: 'Active status of website {#DOMAIN}'
              tags:
                - tag: Application
                  value: 'ISPConfig Websites'
                - tag: Domain
                  value: '{#DOMAIN}'
              
            - uuid: 346628e0-2843-4433-b835-6de1c831dab0
              name: 'Website {#DOMAIN}: Domain'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.website.domain[{#WEBSITE_ID}]'
              delay: 1h
              history: 7d
              trends: '0'
              value_type: CHAR
              description: 'Domain name of website'
              tags:
                - tag: Application
                  value: 'ISPConfig Websites'
                - tag: Domain
                  value: '{#DOMAIN}'
              
            - uuid: f7bdfee1-007a-4b89-a96d-ea461753b0f1
              name: 'Website {#DOMAIN}: Server ID'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.website.server_id[{#WEBSITE_ID}]'
              delay: 1h
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              description: 'Server ID where website is hosted'
              tags:
                - tag: Application
                  value: 'ISPConfig Websites'
                - tag: Domain
                  value: '{#DOMAIN}'
              
            - uuid: 39ffda86-9ade-41f6-afab-2ddb8831d772
              name: 'Website {#DOMAIN}: PHP Version'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.website.php_version[{#WEBSITE_ID}]'
              delay: 1h
              history: 30d
              trends: '0'
              value_type: CHAR
              description: 'PHP version configured for website'
              tags:
                - tag: Application
                  value: 'ISPConfig Websites'
                - tag: Domain
                  value: '{#DOMAIN}'
              
            - uuid: 4367b8a7-0517-43d4-a795-904cfe5fab9c
              name: 'Website {#DOMAIN}: SSL Enabled'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.website.ssl_enabled[{#WEBSITE_ID}]'
              delay: 1h
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              description: 'SSL/TLS status for website'
              tags:
                - tag: Application
                  value: 'ISPConfig Websites'
                - tag: Domain
                  value: '{#DOMAIN}'
              
            - uuid: fb3febd4-7437-4c12-8c6a-73a9188d437e
              name: 'Website {#DOMAIN}: Disk Usage'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.website.disk_usage[{#WEBSITE_ID}]'
              delay: 10m
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              units: B
              description: 'Current disk space usage for website'
              tags:
                - tag: Application
                  value: 'ISPConfig Websites'
                - tag: Domain
                  value: '{#DOMAIN}'
              
            - uuid: 15a83bb2-a640-40e0-806a-38b5214166e7
              name: 'Website {#DOMAIN}: Disk Quota'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.website.hd_quota[{#WEBSITE_ID}]'
              delay: 1h
              history: 30d
              trends: 90d
              value_type: UNSIGNED
              units: B
              description: 'Hard disk quota configured for website'
              tags:
                - tag: Application
                  value: 'ISPConfig Websites'
                - tag: Domain
                  value: '{#DOMAIN}'
              
            - uuid: a91966f6-b7f1-45c7-a0f0-6fd8454909bc
              name: 'Website {#DOMAIN}: Document Root'
              type: ZABBIX_ACTIVE
              key: 'ispconfig.website.document_root[{#WEBSITE_ID}]'
              delay: 1h
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Document root path for website'
              tags:
                - tag: Application
                  value: 'ISPConfig Websites'
                - tag: Domain
                  value: '{#DOMAIN}'
          
          trigger_prototypes:
            - uuid: c39b3557-5260-4077-9b83-1bfef60526cd
              expression: 'last(/ISPConfig Websites/ispconfig.website.active[{#WEBSITE_ID}])=0'
              name: 'Website {#DOMAIN} is inactive'
              priority: WARNING
              description: 'Website {#DOMAIN} has been marked as inactive in ISPConfig'
              tags:
                - tag: Domain
                  value: '{#DOMAIN}'
              
            - uuid: 7b26dfe8-9ddb-4693-8db5-103cee93c11c
              expression: 'last(/ISPConfig Websites/ispconfig.website.disk_usage[{#WEBSITE_ID}])>last(/ISPConfig Websites/ispconfig.website.hd_quota[{#WEBSITE_ID}])*0.9'
              name: 'Website {#DOMAIN} disk usage high (>90%)'
              priority: WARNING
              description: 'Website {#DOMAIN} is using more than 90% of its disk quota'
              manual_close: 'YES'
              tags:
                - tag: Domain
                  value: '{#DOMAIN}'
              
            - uuid: c2f07c9e-b7bf-4b79-bc43-04d583e5f923
              expression: 'last(/ISPConfig Websites/ispconfig.website.disk_usage[{#WEBSITE_ID}])>=last(/ISPConfig Websites/ispconfig.website.hd_quota[{#WEBSITE_ID}])'
              name: 'Website {#DOMAIN} disk quota exceeded'
              priority: HIGH
              description: 'Website {#DOMAIN} has exceeded its disk quota'
              manual_close: 'YES'
              dependencies:
                - name: 'Website {#DOMAIN} disk usage high (>90%)'
                  expression: 'last(/ISPConfig Websites/ispconfig.website.disk_usage[{#WEBSITE_ID}])>last(/ISPConfig Websites/ispconfig.website.hd_quota[{#WEBSITE_ID}])*0.9'
              tags:
                - tag: Domain
                  value: '{#DOMAIN}'
          
          graph_prototypes:
            - uuid: e0ed7a2c-15dd-49f7-a88a-0a99e4ce7002
              name: 'Website {#DOMAIN}: Disk Usage'
              width: '900'
              height: '200'
              show_work_period: 'NO'
              show_triggers: 'YES'
              type: STACKED
              graph_items:
                - color: 1A7C11
                  calc_fnc: ALL
                  item:
                    host: 'ISPConfig Websites'
                    key: 'ispconfig.website.disk_usage[{#WEBSITE_ID}]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'ISPConfig Websites'
                    key: 'ispconfig.website.hd_quota[{#WEBSITE_ID}]'
      
      macros:
        - macro: '{$ISPCONFIG.DISK.WARN}'
          value: '90'
          description: 'Disk usage warning threshold (percentage)'
        
        - macro: '{$ISPCONFIG.DISK.CRIT}'
          value: '95'
          description: 'Disk usage critical threshold (percentage)'